---
title: "Difficulty of Trails at Macleish Station"
subtitle: "SDS 192: MP4"
author: 
- name: Emily Rhyu
  affiliation: Smith College
- name: Alicia Chen
  affiliation: Smith College
- name: Elda Cervantes
  affiliation: Smith College

date: "`r format(Sys.Date(), '%B %e, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    fig_width: 8
    fig_height: 8
    fig_caption: true
    theme: lumen
    df_print: paged
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  echo = TRUE,
  warning = FALSE
)
library(tidyverse)
library(sds192)
library(sf)
library(tidygeocoder)
library(lwgeom)
```

## Introduction

> READ THE INSTRUCTIONS: https://beanumber.github.io/sds192/mod_spatial.html

MacLeish has approximately four miles of built trail for use by field station visitors. We would like to be able to classify these trails as “Easy,” “Moderate,” or “Difficult” based on their length and change in elevation. Use the spatial data to develop a heuristic that will classify these (or any other) trails based on their difficulty. You might want to consult existing trail rating systems. It would be cool if you could create elevation profiles (e.g., this one). Be sure to consult the extended example in MDSR, which walks you through creating an elevation map for one trail. This map has some noted weaknesses. Your goal should be to improve on it and/or make similar maps for all trails.
Supporting data includes:
- Existing trails layer (trails)
- 30’ contour elevation data (elevation)
- 3 meter contours can be retrieved from MassGIS (see help("mass_gis"))
- Property boundary shapefile (boundary)


## Loading the data

```{r, message=FALSE}
library(macleish)
names(macleish_layers)
```

```{r}
# trails <- mass_gis("dcrtrails")
trails <- macleish_layers %>%
  pluck("trails")

contour <- mass_gis("contours250k")

boundary <- macleish_layers %>%
  pluck("boundary")

elevations <- macleish_layers %>%
  pluck("elevation")
```


```{r}
#find the lengths of all the trails by segments
trails_full <- trails %>%
  group_by(name) %>%
  summarize(num_segments = n()) %>%
  mutate(trail_length = st_length(geometry)) %>%
  arrange(desc(trail_length))

#sample for testing
# longest_trail <- trails_full %>%
#   head(1)

#finds elevation for all the trails by segments
trail_elevations <- trails_full %>%
  st_intersection(elevations) %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")
trail_elevations

```

```{r}
#function so that we can get elevation maps for every trail
elevationGrapher <- function(trail_elevations){

trail_elevations <- trail_elevations %>%
  group_by(name)%>%
  mutate(lat = st_coordinates(geometry)[, 2]) %>%
  arrange(lat) %>%
  mutate(distance_from_start = as.numeric(st_distance(geometry)[, 1]))


ggplot(trail_elevations, aes(x = distance_from_start)) + 
  geom_ribbon(aes(ymax = CONTOUR_FT, ymin = 750)) +
  scale_y_continuous("Elevation (feet above sea level)") + 
  scale_x_continuous("Geodesic distance from trail head (meters)") +
  labs(
  title = "Trail Elevation Maps",
  subtitle = "Trails at Macleish Station in Whately, MA",
  caption = "Source: macleish package for R"
  )+
  facet_wrap(~name)
}

elevationGrapher(trail_elevations)

```

# The ratings
```{r}
trail_ratings <- trail_elevations %>%
  group_by(name)%>%
  summarize(
    gain = max(CONTOUR_FT) - min(CONTOUR_FT),
    trail_length = max(units::set_units(trail_length, "miles")),
    rating = sqrt(gain * 2 * as.numeric(trail_length))
  )

trail_ratings <- trail_ratings %>%
  mutate()

```

#Mapping the things
## Static maps

You can make a basic static map with **ggplot2** using `geom_sf()`, as shown in the figure below.

```{r static, fig.cap="The boundary of the MacLeish property., }

boundary_plot <- ggplot() +
  geom_sf(data = boundary) +
  #geom_sf(data = elevations) 
#scale_x_continuous(breaks = c(-72.677, -72.683))
```

```{r}
# map the all the trails on the map
#need to make trails different colors
#need to fix/label axis
boundary_plot +
  geom_sf(data = elevations, color = "dark gray") +
  geom_sf(data = trails, color = "brown", size = 1.5) +
  geom_sf(data = trail_elevations, fill = "yellow", pch = 21, size = 3) +
  geom_sf_label(
    data = trail_elevations,
    aes(label = CONTOUR_FT),
    hjust = "right",
    size = 2.5,
    nudge_x = -0.0005
  )
```


## Dynamic maps

You can make a basic dynamic map with **leaflet**, as shown in the figure below.

```{r dynamic, fig.cap="The boundary of the MacLeish property.",eval=FALSE}
library(leaflet)

leaflet() %>%
  addTiles() %>%
  addPolygons(data = boundary)
```

```{r, eval=FALSE}
ggplot() +
geom_sf(data = macleish_layers[["trails"]], color = "brown")
```


```{r}
# macleish_layers[["trails"]]
```


## Word count

```{r word_count, message=FALSE, echo=FALSE}
text_stats()
```

## Standards

In this assignment, we attempted the following [standards](https://beanumber.github.io/sds192/standards.html):

- `r standard_button("wrangling")`: We met the Wrangling standard because we...
- `r standard_button("spatial")`: We met the Spatial standard because we...
- `r standard_button("leaflet")`: We met the Leaflet standard because we...
- `r standard_button("aesthetics")`: We mastered the Aesthetics standard because we...
- `r standard_button("markdown")`: We mastered the R Markdown standard because we...

## References
