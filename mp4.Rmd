---
title: "Difficulty of Trails at Macleish Station"
subtitle: "SDS 192: MP4"
author: 
- name: Emily Rhyu
  affiliation: Smith College
- name: Alicia Chen
  affiliation: Smith College
- name: Elda Cervantes
  affiliation: Smith College

date: "`r format(Sys.Date(), '%B %e, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    fig_width: 8
    fig_height: 8
    fig_caption: true
    theme: lumen
    df_print: paged
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  echo = TRUE,
  warning = FALSE
)
library(tidyverse)
library(sds192)
library(sf)
library(tidygeocoder)
library(lwgeom)
```

## Prompt

MacLeish has approximately four miles of built trail for use by field station visitors. We would like to be able to classify these trails as “Easy,” “Moderate,” or “Difficult” based on their length and change in elevation. Use the spatial data to develop a heuristic that will classify these (or any other) trails based on their difficulty. You might want to consult existing trail rating systems. It would be cool if you could create elevation profiles (e.g., this one). Be sure to consult the extended example in MDSR, which walks you through creating an elevation map for one trail. This map has some noted weaknesses. Your goal should be to improve on it and/or make similar maps for all trails.

Supporting data includes:
- Existing trails layer (trails)
- 30’ contour elevation data (elevation)
- 3 meter contours can be retrieved from MassGIS (see help("mass_gis"))
- Property boundary shapefile (boundary)

## What We Did

## Loading the data

```{r, message=FALSE}
library(macleish)
```

```{r}
trails <- macleish_layers %>%
  pluck("trails")

contour <- mass_gis("contours250k")

boundary <- macleish_layers %>%
  pluck("boundary")

elevations <- macleish_layers %>%
  pluck("elevation")
```

## Finding the Lengths and Elevations of all the Trails
```{r}
#find the lengths of all the trails by segments
trails_full <- trails %>%
  group_by(name) %>%
  summarize(num_segments = n()) %>%
  mutate(trail_length = st_length(geometry)) %>%
  arrange(desc(trail_length))

#finds elevation for all the trails by segments
trail_elevations <- trails_full %>%
  st_intersection(elevations) %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")
trail_elevations

```

## Elevation Maps 
```{r}
elevationGrapher <- function(trail_elevations){

trail_elevations <- trail_elevations %>%
  group_by(name)%>%
  mutate(lat = st_coordinates(geometry)[, 2]) %>%
  arrange(lat) %>%
  mutate(distance_from_start = as.numeric(st_distance(geometry)[, 1]))


ggplot(trail_elevations, aes(x = distance_from_start)) + 
  geom_ribbon(aes(ymax = CONTOUR_FT, ymin = 750)) +
  scale_y_continuous("Elevation (feet above sea level)") + 
  scale_x_continuous("Geodesic distance from trail head (meters)") +
  labs(
  title = "Trail Elevation Maps",
  subtitle = "Trails at Macleish Station in Whately, MA",
  caption = "Source: macleish package for R"
  )+
  facet_wrap(~name)
}

elevationGrapher(trail_elevations)

```

## The Trail Ratings using Shenandoah system
```{r}
trail_ratings <- trail_elevations %>%
  group_by(name)%>%
  summarize(
    gain = max(CONTOUR_FT) - min(CONTOUR_FT),
    trail_length = max(units::set_units(trail_length, "miles")),
    rating = sqrt(gain * 2 * as.numeric(trail_length))
  )

trail_ratings <- trail_ratings %>%
  mutate(is_difficult = case_when(
    between(rating, 0, 5) ~ "Easy",
    between(rating, 5, 10) ~ "Moderate",
    between(rating, 10, 20) ~ "Difficult",
  ))

```


## Static maps

```{r static }

boundary_plot <- ggplot() +
  geom_sf(data = boundary) 

boundary_plot +
  geom_sf(data = elevations, color = "dark gray") +
  geom_sf(data = trails, color = "brown", size = 1.5) +
  geom_sf(data = trail_elevations, fill = "yellow", pch = 21, size = 3) +
  geom_sf_label(
    data = trail_elevations,
    aes(label = CONTOUR_FT),
    hjust = "right",
    size = 2.5,
    nudge_x = -0.0005
  ) +
  theme(axis.text.x = element_text (angle = 55, vjust = .89, hjust = .9))
```

## Dynamic maps

```{r dynamic}
library(leaflet)

leaflet() %>%
  addTiles() %>%
  addPolygons(data = boundary, weight = 3) %>%
  addPolylines(data = trails, weight = 2, color = "brown") %>%
  addPolygons(data = elevations, weight = 1, color = "yellow")
```

## Word count

```{r word_count, message=FALSE, echo=FALSE}
text_stats()
```

## Standards

In this assignment, we attempted the following [standards](https://beanumber.github.io/sds192/standards.html):

- `r standard_button("wrangling")`: We met the Wrangling standard because we...
- `r standard_button("spatial")`: We met the Spatial standard because we...
- `r standard_button("leaflet")`: We met the Leaflet standard because we...
- `r standard_button("aesthetics")`: We mastered the Aesthetics standard because we...
- `r standard_button("markdown")`: We mastered the R Markdown standard because we...

## References

