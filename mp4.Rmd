---
title: "Put a real title here"
subtitle: "SDS 192: MP4"
author: 
- name: Emily Rhyu
  affiliation: Smith College
- name: Alicia Chen
  affiliation: Smith College
- name: Elda Cervantes
  affiliation: Smith College

date: "`r format(Sys.Date(), '%B %e, %Y')`"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    fig_width: 8
    fig_height: 8
    fig_caption: true
    theme: lumen
    df_print: paged
    code_folding: show
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  message = FALSE,
  echo = TRUE,
  warning = FALSE
)
library(tidyverse)
library(sds192)
library(sf)
library(tidygeocoder)
library(lwgeom)
```

## Introduction

> READ THE INSTRUCTIONS: https://beanumber.github.io/sds192/mod_spatial.html

MacLeish has approximately four miles of built trail for use by field station visitors. We would like to be able to classify these trails as “Easy,” “Moderate,” or “Difficult” based on their length and change in elevation. Use the spatial data to develop a heuristic that will classify these (or any other) trails based on their difficulty. You might want to consult existing trail rating systems. It would be cool if you could create elevation profiles (e.g., this one). Be sure to consult the extended example in MDSR, which walks you through creating an elevation map for one trail. This map has some noted weaknesses. Your goal should be to improve on it and/or make similar maps for all trails.
Supporting data includes:
- Existing trails layer (trails)
- 30’ contour elevation data (elevation)
- 3 meter contours can be retrieved from MassGIS (see help("mass_gis"))
- Property boundary shapefile (boundary)


## Loading the data

```{r, message=FALSE}
library(macleish)
names(macleish_layers)
```

```{r}
# points_of_interest <- tribble(
#   ~name, ~lat, ~long,
#   "Group Campsite", 42.450976, -72.678154, 
#   "Remote campsite", 42.458549, -72.679581,
#   "Parking", 42.448013, -72.680663,
#   "Weather Station OrchardMet", 42.449653, -72.680315,
#   "Weather Station WhatelyMet", 42.448470, -72.680553
# ) %>%
#   st_as_sf(coords = c("long", "lat")) %>%
#   st_set_crs(4326)
```

```{r}
trails <- mass_gis("dcrtrails")

contour <- mass_gis("contours250k")

boundary <- macleish_layers %>%
  pluck("boundary")

elevations <- macleish_layers %>%
  pluck("elevation")
```

```{r}
#locations <- tribble(
 # ~place, ~address, 
  #"Smith", "44 College Lane, Northampton, MA 01063",
  #"Macleish", "30, 78 Poplar Hill Rd, South Deerfield, MA 01373"
  
#) %>%
  #geocoding
 # geocode(address, method = "osm") %>%
  #st_as_sf(coords = c("long", "lat")) %>%
 # st_set_crs(4326)

#maclongitude="-72.68171351473106"
#maclatitude="42.45467547936159"
#macleish <- tibble(place = "Macleish", #geometry="-72.68171351473106,42.45467547936159"
#geometry=st_sfc(st_point(c(42.45467547936159,-72.68171351473106)))
#)

#locations <- locations %>% 
#  inner_join(macleish, by = c("geometry"="geometry"))
```

```{r, eval=FALSE}
#location of macleish
# mac <- leaflet() %>%
#   addTiles() %>%
#   addMarkers(
#     lng =  -72.68171351473106,
#     lat = 42.45467547936159,
#     popup = "Macleish"
#   )
# mac
```

```{r, eval=FALSE}

# trails <- macleish_layers[["trails"]] 
# trails %>%
#   group_by(name) %>%
#   summarize(num_segments = n()) %>%
#   mutate(trail_length = st_length(geometry)) %>%
#   arrange(desc(trail_length))
  
```

```{r}
#might use to find flat/hilly path (50 is flattest/easiest)
#use summarize?
#rating <- sqrt(2 * gain * distance)

trails_full <- trails %>%
  group_by(name) %>%
  summarize(num_segments = n()) %>%
  mutate(trail_length = st_length(geometry)) %>%
  arrange(desc(trail_length))

longest_trail <- trails_full %>%
  head(1)

#finds elevation for trail in question. probably use to apply to flat/hilly trails found from equation above and make elevation profile

trail_elevations <- trails_full %>%
  st_intersection(elevations) %>%
  st_cast("MULTIPOINT") %>%
  st_cast("POINT")
trail_elevations

#elevationGrapher <- function(trailIn){
  
  

# boundary <- macleish_layers %>% pluck("boundary")
# boundary_plot <- ggplot(boundary) + 
#   geom_sf() + 
#   scale_x_continuous(breaks = c(-72.677, -72.683))

# boundary_plot +
#   geom_sf(data = elevations, color = "dark gray") + 
#   geom_sf(data = longest_trail, color = "brown", size = 1.5) + 
#   geom_sf(data = trail_elevations, fill = "yellow", pch = 21, size = 3) + 
#   geom_sf_label(
#     data = trail_elevations, 
#     aes(label = CONTOUR_FT), 
#     hjust = "right", 
#     size = 2.5,
#     nudge_x = -0.0005
#   )

trail_elevations <- trail_elevations %>%
  mutate(lat = st_coordinates(geometry)[, 2]) %>%
  arrange(lat) %>%
  mutate(distance_from_start = as.numeric(st_distance(geometry)[, 1]))

graphName <- paste("Trail elevation map:", trailIn$name)

ggplot(trail_elevations, aes(x = distance_from_start)) + 
  geom_ribbon(aes(ymax = CONTOUR_FT, ymin = 750)) +
  scale_y_continuous("Elevation (feet above sea level)") + 
  scale_x_continuous("Geodesic distance from trail head (meters)") +
  labs(
    title = graphName,
    subtitle = "Whately, MA",
    caption = "Source: macleish package for R"
  )
#}

#elevationGrapher(longest_trail)

```



## Static maps

You can make a basic static map with **ggplot2** using `geom_sf()`, as shown in the figure below.

```{r static, fig.cap="The boundary of the MacLeish property."}

boundary_plot <- ggplot() +
  geom_sf(data = boundary) +
  geom_sf(data = elevations) 
```

```{r, eval=FALSE}
#example we can reference
# boundary_plot +
#   geom_sf(data = elevations, color = "dark gray") + 
#   geom_sf(data = longest_trail, color = "brown", size = 1.5) + 
#   geom_sf(data = trail_elevations, fill = "yellow", pch = 21, size = 3) + 
#   geom_sf_label(
#     data = trail_elevations, 
#     aes(label = CONTOUR_FT), 
#     hjust = "right", 
#     size = 2.5,
#     nudge_x = -0.0005
#   )
```


## Dynamic maps

You can make a basic dynamic map with **leaflet**, as shown in the figure below.

```{r dynamic, fig.cap="The boundary of the MacLeish property.",eval=FALSE}
library(leaflet)

leaflet() %>%
  addTiles() %>%
  addPolygons(data = boundary)
```

```{r}
ggplot() +
geom_sf(data = macleish_layers[["trails"]], color = "brown")
```


```{r}
# macleish_layers[["trails"]]
```


## Word count

```{r word_count, message=FALSE, echo=FALSE}
text_stats()
```

## Standards

In this assignment, we attempted the following [standards](https://beanumber.github.io/sds192/standards.html):

- `r standard_button("wrangling")`: We met the Wrangling standard because we...
- `r standard_button("spatial")`: We met the Spatial standard because we...
- `r standard_button("leaflet")`: We met the Leaflet standard because we...
- `r standard_button("aesthetics")`: We mastered the Aesthetics standard because we...
- `r standard_button("markdown")`: We mastered the R Markdown standard because we...

## References
